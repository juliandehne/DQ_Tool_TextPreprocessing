<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yannik Peters">

<title>Comparing Tools and Workflows for Data Quality in Text Preprocessing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Text_Processing_Tool_files/libs/clipboard/clipboard.min.js"></script>
<script src="Text_Processing_Tool_files/libs/quarto-html/quarto.js"></script>
<script src="Text_Processing_Tool_files/libs/quarto-html/popper.min.js"></script>
<script src="Text_Processing_Tool_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Text_Processing_Tool_files/libs/quarto-html/anchor.min.js"></script>
<link href="Text_Processing_Tool_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Text_Processing_Tool_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Text_Processing_Tool_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Text_Processing_Tool_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Text_Processing_Tool_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Comparing Tools and Workflows for Data Quality in Text Preprocessing</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Yannik Peters </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>The digitalisation has led to an innovation of research objects and research methods. While statistical methods to analyze numerical data have a long tradition, it is especially the automated analysis of text data that has seen huge improvement in recent years. Automated text analysis methods are applied to various data sources, be it social media data, news paper articles, parliamentary speeches, historical texts or literature. In this introduction, we want to focus on an important, necessary and often times challenging aspect related to data quality in text data: the text processing. Text processing can be defined as all changes that are done to the text data after the data collection and before the data analysis. Its main purpose is to bring the raw data in a form that is then suitable for applying specific research methods, but also to reduce the probability of errors. In this sense, text processing is heavily related to the measurement dimension of data quality. On the one hand, text processing can help to reduce measurement errors, by increasing consistency or accuracy. On the other hand, text processing itself can become a source for potential errors. In the TED-On, the “Total Error Framework for Digital Traces of Human Behavior On Online Platforms” <span class="citation" data-cites="sen2021">(<a href="#ref-sen2021" role="doc-biblioref">Sen et al. 2021</a>)</span> these errors are referred to as <code>trace reduction errors</code>. According to Sen et al.&nbsp;an example for this error would be: “Researchers might decide to use a classifier that removes spam, but has a high false positive rate, inadvertently removing non-spam tweets. They might likewise discard tweets without textual content, thereby ignoring relevant statements made through hyper-links or embedded pictures/videos” (p.&nbsp;413).</p>
<p>In this tutorial we want to go through all the classic steps of text processing and compare as well as recommend different packages and tools to use. The final step is gonna be to create a document-feature-matrix (DFM) or more precise a document-term-matrix (DTM), that is used often times for multiple analysis techniques such as sentiment analysis or topic modeling. For this purpose, we created a small social media data set with posts about the Olympic summer games in Paris 2024. The Olympic summer games can be considered a transnational media event <span class="citation" data-cites="hepp2015">(<a href="#ref-hepp2015" role="doc-biblioref">Hepp 2015</a>)</span>, which is nowadays of course not only covered by traditional media but is communicatively accompanied on social media. For copyright reasons, we have constructed an artificial data set which does not contain any real content.</p>
</section>
<section id="set-up" class="level1">
<h1>2. Set up</h1>
<p>At first, we will open all relevant libraries. Please make sure to have all relevant packages installed using the <code>install.packages()</code> command. We will be using and comparing some of the most important text preprocessing and analysis R packages like <code>quanteda</code>, <code>stringr</code>, <code>textclean</code> or <code>tm</code>. We will also use specific packages like <code>skimr</code>, <code>spelling</code>, <code>polyglotr</code> or <code>deeplr</code> for very specific purposes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textclean)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textTinyR)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spelling) </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hunspell)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(polyglotr)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(deeplr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we will then load our artificial dataset from the Olympic summer games.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>olympics_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"6.modified_olympics_tweets_RT.csv"</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"Latin1"</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>olympics_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 150 × 14
     no. tweet_id user_id timestamp        username tweet_text subtopic language
   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;   
 1     1      226     139 09-08-2024 20:14 @kimber… RT The po… Swimmin… en      
 2     2    68257     133 31-07-2024 05:42 @colema… The fight… Doping … en      
 3     3    44351     197 06-08-2024 14:25 @joseph… RT THE JO… Gold Me… en      
 4     4    95759     170 08-08-2024 06:41 @randal… Quel chem… Gold Me… fr      
 5     5    11173     106 27-07-2024 18:19 @scott81 The inten… Wrestli… en      
 6     6    23334     177 28-07-2024 10:44 @ghall   RT We mus… Doping … en      
 7     7    49688     160 04-08-2024 00:40 @shanew… RT The cu… Gold Me… en      
 8     8    39066     196 01-08-2024 08:25 @kimgra… RT Cheeri… Maratho… en      
 9     9    81586     198 31-07-2024 21:03 @theres… RT Jede L… Athlete… de      
10    10    45338     134 03-08-2024 09:55 @kennet… What a ga… Basketb… en      
# ℹ 140 more rows
# ℹ 6 more variables: retweet_count &lt;dbl&gt;, like_count &lt;dbl&gt;, reply_count &lt;dbl&gt;,
#   quote_count &lt;dbl&gt;, urls &lt;chr&gt;, source &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="application-of-tools-and-use-case" class="level1">
<h1>3. Application of tools and use case</h1>
<section id="basic-data-quality-checks" class="level3">
<h3 class="anchored" data-anchor-id="basic-data-quality-checks">3.1 Basic data (quality) checks</h3>
<p>Let’s start with checking out the basic structure of our dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(olympics_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [150 × 14] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ no.          : num [1:150] 1 2 3 4 5 6 7 8 9 10 ...
 $ tweet_id     : num [1:150] 226 68257 44351 95759 11173 ...
 $ user_id      : num [1:150] 139 133 197 170 106 177 160 196 198 134 ...
 $ timestamp    : chr [1:150] "09-08-2024 20:14" "31-07-2024 05:42" "06-08-2024 14:25" "08-08-2024 06:41" ...
 $ username     : chr [1:150] "@kimberlyberg" "@colemanjoseph" "@josephmatthew" "@randallsmith" ...
 $ tweet_text   : chr [1:150] "RT The pool is alive with excitement! Who will claim victory in #SwimmingOlympics? The competition is fierce!  "| __truncated__ "The fight against doping is ongoing! Let's support our athletes by promoting #CleanSport at #Olympics2024. #Dop"| __truncated__ "RT THE JOY OF WINNING A #GOLDMEDAL IS UNMATCHED! WHO ARE YOU SUPPORTING AT #OLYMPICS2024? #OLYMPICS2024 #PARIS2024" "Quel chemin parcouru ! Les gagnants de la #Médaille d'or nous ont tous rendus fiers ! #Olympiques2024 #Médaille"| __truncated__ ...
 $ subtopic     : chr [1:150] "Swimming Events" "Doping Awareness" "Gold Medal Moments" "Gold Medal Moments" ...
 $ language     : chr [1:150] "en" "en" "en" "fr" ...
 $ retweet_count: num [1:150] 175 279 148 136 141 185 115 299 65 271 ...
 $ like_count   : num [1:150] 610 774 382 0 489 918 282 222 28 393 ...
 $ reply_count  : num [1:150] 7 2 10 0 7 7 0 2 1 7 ...
 $ quote_count  : num [1:150] 1 2 8 0 5 9 8 2 6 2 ...
 $ urls         : chr [1:150] "https://www.rubio-jones.info/" NA NA "http://www.jones.com/" ...
 $ source       : chr [1:150] "Twitter Web App" "Twitter Web App" "Twitter for iPhone" "Twitter for iPhone" ...
 - attr(*, "spec")=
  .. cols(
  ..   no. = col_double(),
  ..   tweet_id = col_double(),
  ..   user_id = col_double(),
  ..   timestamp = col_character(),
  ..   username = col_character(),
  ..   tweet_text = col_character(),
  ..   subtopic = col_character(),
  ..   language = col_character(),
  ..   retweet_count = col_double(),
  ..   like_count = col_double(),
  ..   reply_count = col_double(),
  ..   quote_count = col_double(),
  ..   urls = col_character(),
  ..   source = col_character()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>Here we find 13 variables and 150 observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(olympics_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      no.            tweet_id        user_id       timestamp        
 Min.   :  1.00   Min.   :  226   Min.   :100.0   Length:150        
 1st Qu.: 38.25   1st Qu.:24485   1st Qu.:128.0   Class :character  
 Median : 75.50   Median :49100   Median :149.5   Mode  :character  
 Mean   : 75.50   Mean   :50367   Mean   :151.1                     
 3rd Qu.:112.75   3rd Qu.:73639   3rd Qu.:177.0                     
 Max.   :150.00   Max.   :99451   Max.   :200.0                     
   username          tweet_text          subtopic           language        
 Length:150         Length:150         Length:150         Length:150        
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
 retweet_count      like_count     reply_count     quote_count    
 Min.   :  1.00   Min.   :  0.0   Min.   : 0.00   Min.   : 0.000  
 1st Qu.: 82.25   1st Qu.:282.0   1st Qu.: 3.00   1st Qu.: 3.000  
 Median :150.50   Median :477.0   Median : 7.00   Median : 5.000  
 Mean   :151.23   Mean   :499.8   Mean   : 6.86   Mean   : 5.207  
 3rd Qu.:219.50   3rd Qu.:742.5   3rd Qu.:10.00   3rd Qu.: 8.000  
 Max.   :299.00   Max.   :977.0   Max.   :15.00   Max.   :10.000  
     urls              source         
 Length:150         Length:150        
 Class :character   Class :character  
 Mode  :character   Mode  :character  
                                      
                                      
                                      </code></pre>
</div>
</div>
<p>When running the <code>summary()</code> function, the overview might get a bit messy depending on the size of the dataframe. We therefore recommend R tools, that offer basic data quality reports and arrange the results clearly like the <code>skimr</code> package. Here, you can receive an overview of the various variables of our data set including descriptive statistics and missing values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(olympics_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">olympics_data</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">150</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">timestamp</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">username</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tweet_text</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">114</td>
<td style="text-align: right;">192</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">128</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">subtopic</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">language</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">urls</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">source</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 14%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 4%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">no.</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">75.50</td>
<td style="text-align: right;">43.45</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38.25</td>
<td style="text-align: right;">75.5</td>
<td style="text-align: right;">112.75</td>
<td style="text-align: right;">150</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">tweet_id</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">50367.45</td>
<td style="text-align: right;">28499.46</td>
<td style="text-align: right;">226</td>
<td style="text-align: right;">24485.00</td>
<td style="text-align: right;">49099.5</td>
<td style="text-align: right;">73639.00</td>
<td style="text-align: right;">99451</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">user_id</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">151.09</td>
<td style="text-align: right;">29.09</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">128.00</td>
<td style="text-align: right;">149.5</td>
<td style="text-align: right;">177.00</td>
<td style="text-align: right;">200</td>
<td style="text-align: left;">▆▇▆▇▆</td>
</tr>
<tr class="even">
<td style="text-align: left;">retweet_count</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">151.23</td>
<td style="text-align: right;">83.81</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">82.25</td>
<td style="text-align: right;">150.5</td>
<td style="text-align: right;">219.50</td>
<td style="text-align: right;">299</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">like_count</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">499.75</td>
<td style="text-align: right;">271.89</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">282.00</td>
<td style="text-align: right;">477.0</td>
<td style="text-align: right;">742.50</td>
<td style="text-align: right;">977</td>
<td style="text-align: left;">▆▇▇▇▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">reply_count</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.86</td>
<td style="text-align: right;">4.61</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: right;">10.00</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">▇▅▆▃▅</td>
</tr>
<tr class="odd">
<td style="text-align: left;">quote_count</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.21</td>
<td style="text-align: right;">3.12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">▇▇▇▅▇</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="dealing-with-multiple-languages" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-multiple-languages">3.2 Dealing with multiple languages</h3>
<p>As the Olympic games are a transnational media event, it does not come as a surprise to receive a multilingual data set. The basic problem about multilingual data sets is that common CSS research methods like topic modeling or sentiment analysis are expected to be in one language. There are different strategies to deal with multilingual data sets. The chosen strategy has to depend on the specific contexts, the applied methods and the research design and questions. We can basically distinguish three or four main strategies with regard to multilingual data sets (see <span class="citation" data-cites="haukelicht2023">Hauke Licht and Fabienne Lind (<a href="#ref-haukelicht2023" role="doc-biblioref">2023</a>)</span>, <span class="citation" data-cites="lind2021a">Lind et al. (<a href="#ref-lind2021a" role="doc-biblioref">2021</a>)</span>). For this short version, we will discuss three main strategies.</p>
<p>1) Selecting cases: one language</p>
<p>This approach is basically about choosing cases that only contain documents in one language. For our Twitter/X data set, we could for instance remove all postings which are not English ones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>olympics_data_en <span class="ot">&lt;-</span> olympics_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"en"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(olympics_data_en<span class="sc">$</span>language)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 en 
130 </code></pre>
</div>
</div>
<p>Of course, this strategy might result in a representation error as we systematically exclude specific content from analysis (in our case twenty tweets). So let’s take a look at the other strategies.</p>
<p>2) Multiple single language data sets</p>
<p>Another way of dealing with multilingual data sets is to create language specific subsamples of our data. The main advantage of this strategy is, that we do not lose any content due to exclusion or translation errors. However, compared to the other methods there are more validation steps required with regard to the each single language data set (for detailed information see <span class="citation" data-cites="haukelicht2023">Hauke Licht and Fabienne Lind (<a href="#ref-haukelicht2023" role="doc-biblioref">2023</a>)</span>, <span class="citation" data-cites="lind2021a">Lind et al. (<a href="#ref-lind2021a" role="doc-biblioref">2021</a>)</span>). As we have already created a data set which only contains English tweets, we will create two more dataframes for German and French tweets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>olympics_data_de <span class="ot">&lt;-</span> olympics_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"de"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(olympics_data_de<span class="sc">$</span>language)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
de 
12 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>olympics_data_fr <span class="ot">&lt;-</span> olympics_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"fr"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(olympics_data_fr<span class="sc">$</span>language)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
fr 
 8 </code></pre>
</div>
</div>
<p>We only find a few documents that are not in English resulting in some very small language sets. Therefore, this strategy might not be the best with regard to our example data.</p>
<p>3) Translating</p>
<p>The third option of dealing with multilingual datasets is to translate the non-English speaking tweets into English. As this is a just a small, artificial, sample data set, we could actually translate the few tweets manually. In a real case scenario however, analyzing a data set of millions of tweets, you would usually use a automated translation algorithm or method. The most common translation tools are <code>Google Translator</code> and <code>DeepL</code>. The main advantage of the translation method is to generate one singular data set, which can then be analyzed with one model only. This requires less resources all well. The main disadvantage lies in the potential of translation errors. It is therefore necessary to evaluate your translation method. For this purpose, let’s translate all non-English comments with both tools in order to compare the results. First, we will use the <code>polyglotr</code> and the <code>deeplr</code> package to translate the German text.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Translation of German posts and creation of translated dataframe using Google Translate</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>translation_google_de <span class="ot">&lt;-</span> <span class="fu">google_translate</span>(olympics_data_de<span class="sc">$</span>tweet_text, <span class="at">target_language =</span> <span class="st">"en"</span>, <span class="at">source_language =</span> <span class="st">"de"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>translation_google_de <span class="ot">&lt;-</span> <span class="fu">sapply</span>(translation_google_de, <span class="cf">function</span>(x) x[[<span class="dv">1</span>]])</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>olympics_data_de_google <span class="ot">&lt;-</span> olympics_data_de</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>olympics_data_de_google<span class="sc">$</span>tweet_text <span class="ot">&lt;-</span> translation_google_de</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To access the DeepL API, you currently need a developer account. You can use this <a href="https://www.deepl.com/en/pro/change-plan#developer">link</a> to get to the registration page. A free account can translate up to 500,000 characters per month and gives you access to the DeepL Rest API. In order to translate our text using DeepL in R, you first need this API-key. When signing up for a developer account, you automatically receive such a key.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Translation of German posts and creation of translated dataframe using DeepL</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>translation_deepl_de <span class="ot">&lt;-</span> <span class="fu">translate2</span>(olympics_data_de<span class="sc">$</span>tweet_text, <span class="at">target_lang =</span> <span class="st">"EN"</span>, <span class="at">auth_key =</span> my_key)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>olympics_data_de_deepl <span class="ot">&lt;-</span> olympics_data_de</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>olympics_data_de_deepl<span class="sc">$</span>tweet_text <span class="ot">&lt;-</span> translation_deepl_de</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For this code to work, make sure that you create a my_key object containing your API key.</p>
<p>my_key &lt;- “Your key”</p>
</div>
</div>
<p>Let’s compare the results for the German tweets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(olympics_data_de_google<span class="sc">$</span>tweet_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "RT Every achievement at #Olympics2024 underlines the hard work and dedication of our athletes! #Athletes #Olympiade2024 #Paris2024"                                        
[2] "RT What a journey it was! The #goldmedalists made us all proud! #Olympiade2024 #Goldmedal #Olympiade2024 #Paris2024"                                                       
[3] "Integrity in sport is important! Let's promote fair competition and say no to doping! #DopingSkandal #Olympics2024 #DopingSkandal #SayNoToDoping #CleanSport #Olympics2024"
[4] "History will be made at the #SwimmingOlympics! Every stroke counts as athletes dive for glory! #GoldMedal #SwimmingOlympics #Olympics2024 #GoldMedal"                      
[5] "It's unbelievable what's possible in #basketball! Who's your favorite team? #Olympiade2024 #Basketball #Olympiade2024 #Paris2024"                                          
[6] "RT The teamwork in #basketball is incredible! Go for gold! #Olympiade2024 #Basketball #Olympiade2024 #Paris2024"                                                           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(olympics_data_de_deepl<span class="sc">$</span>tweet_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "RT Every performance at #Olympics2024 highlights the hard work and dedication of our athletes! #athletes #Olympics2024 #Paris2024"                                         
[2] "RT What a journey it's been! The #goldmedal winners have made us all proud! #Olympics2024 #goldmedal #Olympics2024 #Paris2024"                                             
[3] "Integrity in sport is important! Let's promote fair competition and say no to doping! #DopingScandal #Olympics2024 #DopingScandal #SayNoToDoping #CleanSport #Olympics2024"
[4] "History is being made at the #SwimmingOlympics! Every stroke counts as athletes dive for glory! #GoldMedal #SwimmingOlympics #Olympics2024 #GoldMedal"                     
[5] "It's unbelievable what's possible in #basketball! Who's your favorite team? #Olympiad2024 #Basketball #Olympiad2024 #Paris2024"                                            
[6] "RT The teamwork in #basketball is incredible! Go for gold! #Olympics2024 #Basketball #Olympics2024 #Paris2024"                                                             </code></pre>
</div>
</div>
<p>We can see from a quick comparison that the translations seem pretty similar. We can also use certain metric to determine the degree of similarity. For this example, we will apply <a href="https://towardsdatascience.com/overview-of-text-similarity-metrics-3397c4601f50">cosine similarity</a>. First, we have to <code>unlist</code> our text data, as the <code>COS_TEXT</code> function of the <code>textTidyR</code> package requires a vector as an input.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>google_translation_de <span class="ot">&lt;-</span> <span class="fu">unlist</span>(translation_google_de)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>deepl_translation_de <span class="ot">&lt;-</span> <span class="fu">unlist</span>(translation_deepl_de)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>cosine_similarities <span class="ot">&lt;-</span> <span class="fu">COS_TEXT</span>(google_translation_de, deepl_translation_de, <span class="at">separator =</span> <span class="st">" "</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>cosine_similarities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.7789808 0.5025189 0.8333333 0.9047619 0.7500000 0.7500000 0.9622504
 [8] 0.9164397 0.7619048 1.0000000 0.7735268 0.8858796</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(cosine_similarities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8182997</code></pre>
</div>
</div>
<p>With a mean cosine similarity of 0.82 on a scale from 0 to 1, the translations of Google Translate and DeepL are indeed very similar. We can do the very same for the French postings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Translation of French posts and creation of translated dataframe using Google Translate</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>translation_google_fr <span class="ot">&lt;-</span> <span class="fu">google_translate</span>(olympics_data_fr<span class="sc">$</span>tweet_text, <span class="at">target_language =</span> <span class="st">"en"</span>, <span class="at">source_language =</span> <span class="st">"fr"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>translation_google_fr <span class="ot">&lt;-</span> <span class="fu">sapply</span>(translation_google_fr, <span class="cf">function</span>(x) x[[<span class="dv">1</span>]])</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>olympics_data_fr_google <span class="ot">&lt;-</span> olympics_data_fr</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>olympics_data_fr_google<span class="sc">$</span>tweet_text <span class="ot">&lt;-</span> translation_google_fr</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Translation of French posts and creation of translated dataframe using DeepL</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>translation_deepl_fr <span class="ot">&lt;-</span> <span class="fu">translate2</span>(olympics_data_fr<span class="sc">$</span>tweet_text, <span class="at">target_lang =</span> <span class="st">"EN"</span>, <span class="at">auth_key =</span> my_key)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>olympics_data_fr_deepl <span class="ot">&lt;-</span> olympics_data_fr</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>olympics_data_fr_deepl<span class="sc">$</span>tweet_text <span class="ot">&lt;-</span> translation_deepl_fr</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">#compare Google Translate und Deepl translation manually</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>olympics_data_fr_google<span class="sc">$</span>tweet_text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "What a journey! The #GoldMedal winners made us all proud! #Olympics2024 #GoldMedal #Olympics2024 #Paris2024"                                                          
[2] "Integrity in sport matters! Let's promote fair competition and say no to doping! #DopingScandal #Olympics2024 #DopingScandal #SayNoToDoping #CleanSport #Olympics2024"
[3] "Every takedown counts! The competitive spirit is alive at #Wrestling2024! #Olympics2024 #Lutte2024 #Olympics2024 #Paris2024"                                          
[4] "What a journey we have come! Join us for the #ClosingCeremony2024 to relive these magical moments. #ClosingCeremony2024 #Olympics2024"                                
[5] "The teamwork shown in #Basketball is incredible! Go for gold! #Olympics2024 #Basketball #Olympics2024 #Paris2024"                                                     
[6] "What a display of talent! These athletes are making their mark at the #Olympics2024! #athletes #Olympics2024 #Paris2024"                                              
[7] "RT Let's celebrate the athletes who made their dreams come true by winning gold medals! #GoldMedal #Olympics2024 #Paris2024"                                          
[8] "Exciting moments await us in #Basketball at the #Olympics2024! Let the games begin! #Basketball #Olympics2024 #Paris2024"                                             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>olympics_data_fr_deepl<span class="sc">$</span>tweet_text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "What a long way we've come! The #GoldMedal winners made us all proud! #Olympics2024 #Gold Medal #Olympics2024 #Paris2024"                                                  
[2] "Integrity in sport is important! Let's promote fair competition and say no to doping! #DopingScandal #Olympics2024 #DopingScandal #SayNoToDoping #CleanSport #Olympics2024"
[3] "Every takedown counts! The competitive spirit is alive and well at #Wrestling2024! #Olympiques2024 #Wrestling2024 #Olympiques2024 #Paris2024"                              
[4] "What a journey we've made! Join us for the #ClosingCeremony2024 to relive those magical moments. #ClosingCeremony2024 #Olympics2024"                                       
[5] "The teamwork shown by #Basketball is incredible! Go for the gold! #Olympiques2024 #Basketball #Olympiques2024 #Paris2024"                                                  
[6] "What a display of talent! These athletes are making their mark at the #Olympics2024! #athletes #Olympics2024 #Paris2024"                                                   
[7] "RT Let's celebrate the athletes who made their dreams come true by winning gold medals! #GoldMedal #Olympics2024 #Paris2024"                                               
[8] "Exciting moments await us in #Basketball at the #Olympics2024! Let the games begin! #Basketball #Olympiques2024 #Paris2024"                                                </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#unlist french translation data</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>google_translation_fr <span class="ot">&lt;-</span> <span class="fu">unlist</span>(translation_google_fr)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>deepl_translation_fr <span class="ot">&lt;-</span> <span class="fu">unlist</span>(translation_deepl_fr)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate cosine similarities for French translation data</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>cosine_similarities <span class="ot">&lt;-</span> <span class="fu">COS_TEXT</span>(google_translation_fr, deepl_translation_fr, <span class="at">separator =</span> <span class="st">" "</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>cosine_similarities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7905694 0.9363822 0.6481812 0.8207827 0.7029595 1.0000000 1.0000000
[8] 0.9500000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(cosine_similarities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8561094</code></pre>
</div>
</div>
<p>With an average cosine similarity of 0.86, it is slightly higher for the French than the German translation.</p>
<p>The key question for us is now: Do we want to use the translation of DeepL or Google Translate? Generally, DeepL is considered to be more accurate then Google Translate (like <a href="https://www.geeksforgeeks.org/deepl-vs-google/">here</a>). In current research, both tools are considered applicable. For the translation of Spanish idiomatic expressions into English, <span class="citation" data-cites="hidalgo-ternero2021">Hidalgo-Ternero (<a href="#ref-hidalgo-ternero2021" role="doc-biblioref">2021</a>)</span> find DeepL with an average accuracy rate of 89% slighty better than Google Translate with 86%. <span class="citation" data-cites="sebo2024">Sebo and Lucia (<a href="#ref-sebo2024" role="doc-biblioref">2024</a>)</span> do not find significant differences in the accuracy of both tools. One of the major advantages of Google Translate is that it can be applied to significantly more languages than DeepL. As we only have two languages to translate in our case, we will use the DeepL translation here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>olympics_data_en_full <span class="ot">&lt;-</span> <span class="fu">rbind</span>(olympics_data_en, olympics_data_de_deepl, olympics_data_fr_deepl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="minor-text-operations-removing-special-characters" class="level3">
<h3 class="anchored" data-anchor-id="minor-text-operations-removing-special-characters">3.3 Minor text operations: removing special characters</h3>
</section>
<section id="removing-stopwords" class="level3">
<h3 class="anchored" data-anchor-id="removing-stopwords">3.4 Removing stopwords</h3>
<p>In text preprocessing of social media data, there are often times certain typical preprocessing steps included like removing special characters or changing capital letters to lower cases.</p>
</section>
<section id="identifying-misspelling" class="level3">
<h3 class="anchored" data-anchor-id="identifying-misspelling">3.5 Identifying misspelling</h3>
<p>Now, we have created one data set with only English language postings. Next, we want to check is whether the text is correct in terms of spelling. Spelling errors are problematic with regard to text data quality as specific words might not be considered as equal to the correct word by specific methods. We therefore want to check the text data for errors. In R, there are many packages for spelling corrections.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to check spelling and return misspelled words with line numbers and corrections on the basis of hunspell dictionary</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>check_spelling_and_correct <span class="ot">&lt;-</span> <span class="cf">function</span>(text) { </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use spell_check_text function from the spelling package </span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>misspelled <span class="ot">&lt;-</span> <span class="fu">spell_check_text</span>(text) </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(misspelled) <span class="sc">&gt;</span> <span class="dv">0</span>) { </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a string of misspelled words with their positions </span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>misspelled_str <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(misspelled), <span class="cf">function</span>(i) { </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(misspelled<span class="sc">$</span>word[i], <span class="st">" ("</span>, <span class="fu">paste</span>(misspelled<span class="sc">$</span>found[[i]], <span class="at">collapse =</span> <span class="st">","</span>), <span class="st">")"</span>) </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>}), <span class="at">collapse =</span> <span class="st">"; "</span>) </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate suggestions for misspelled words </span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>suggestions <span class="ot">&lt;-</span> <span class="fu">hunspell_suggest</span>(misspelled<span class="sc">$</span>word) </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>corrections <span class="ot">&lt;-</span> <span class="fu">sapply</span>(suggestions, <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">length</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span>, x[<span class="dv">1</span>], <span class="cn">NA</span>)) </span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a string of corrections </span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>corrections_str <span class="ot">&lt;-</span> <span class="fu">paste</span>(corrections, <span class="at">collapse =</span> <span class="st">"; "</span>) </span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">list</span>(<span class="at">misspelled =</span> misspelled_str, <span class="at">corrections =</span> corrections_str)) </span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> { </span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">list</span>(<span class="at">misspelled =</span> <span class="cn">NA_character_</span>, <span class="at">corrections =</span> <span class="cn">NA_character_</span>))}} </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the spelling check and correction to each tweet </span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>olympics_data_new <span class="ot">&lt;-</span> olympics_data_en_full <span class="sc">%&gt;%</span> </span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">Spelling_Check =</span> <span class="fu">lapply</span>(tweet_text, check_spelling_and_correct), </span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a><span class="at">Misspelled_Words =</span> <span class="fu">sapply</span>(Spelling_Check, <span class="cf">function</span>(x) x<span class="sc">$</span>misspelled), </span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="at">Corrected_Spellings =</span> <span class="fu">sapply</span>(Spelling_Check, <span class="cf">function</span>(x) x<span class="sc">$</span>corrections)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="sc">-</span>Spelling_Check)  <span class="co"># Remove the intermediate column </span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="co"># View the results </span></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(olympics_data_new[<span class="fu">c</span>(<span class="st">"tweet_text"</span>, <span class="st">"Misspelled_Words"</span>, <span class="st">"Corrected_Spellings"</span>)]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  tweet_text                                Misspelled_Words Corrected_Spellings
  &lt;chr&gt;                                     &lt;chr&gt;            &lt;chr&gt;              
1 RT The pool is alive with excitement! Wh… SwimmingOlympic… Swimming Olympics  
2 The fight against doping is ongoing! Let… CleanSport (1);… Clean Sport; Dopin…
3 RT THE JOY OF WINNING A #GOLDMEDAL IS UN… GOLDMEDAL (1)    GOLD MEDAL         
4 The intensity of the #Wrestling2024 matc… &lt;NA&gt;             &lt;NA&gt;               
5 RT We must stand united against doping! … CleanSport (1);… Clean Sport; Dopin…
6 RT The culmination of years of effort re… GoldMedal (1)    Gold Medal         </code></pre>
</div>
</div>
</section>
<section id="creating-a-dfm-tokenization-and-lemmatization" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-dfm-tokenization-and-lemmatization">3.6 Creating a DFM: tokenization and lemmatization</h3>
</section>
<section id="lda-analysis" class="level3">
<h3 class="anchored" data-anchor-id="lda-analysis">3.7 LDA Analysis</h3>
</section>
</section>
<section id="discussion" class="level1">
<h1>4. Discussion</h1>
</section>
<section id="literature" class="level1 unnumbered">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">5. Literature</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-haukelicht2023" class="csl-entry" role="listitem">
Hauke Licht, and Fabienne Lind. 2023. <span>“Going Cross-Lingual: A Guide to Multilingual Text Analysis.”</span> <em>Computational Communication Research</em> 5 (2): 1. <a href="https://doi.org/10.5117/ccr2023.2.3.lich">https://doi.org/10.5117/ccr2023.2.3.lich</a>.
</div>
<div id="ref-hepp2015" class="csl-entry" role="listitem">
Hepp, Andreas. 2015. <span>“Transcultural Communication,”</span> June. <a href="https://doi.org/10.1002/9781394261390">https://doi.org/10.1002/9781394261390</a>.
</div>
<div id="ref-hidalgo-ternero2021" class="csl-entry" role="listitem">
Hidalgo-Ternero, Carlos Manuel. 2021. <span>“Google Translate Vs. DeepL.”</span> <em>MonTI. Monografías de Traducción e Interpretación</em>, January, 154–77. <a href="https://doi.org/10.6035/monti.2020.ne6.5">https://doi.org/10.6035/monti.2020.ne6.5</a>.
</div>
<div id="ref-lind2021a" class="csl-entry" role="listitem">
Lind, Fabienne, Jakob-Moritz Eberl, Olga Eisele, Tobias Heidenreich, Sebastian Galyga, and Hajo G. Boomgaarden. 2021. <span>“Building the Bridge: Topic Modeling for Comparative Research.”</span> <em>Communication Methods and Measures</em> 16 (2): 96–114. <a href="https://doi.org/10.1080/19312458.2021.1965973">https://doi.org/10.1080/19312458.2021.1965973</a>.
</div>
<div id="ref-sebo2024" class="csl-entry" role="listitem">
Sebo, Paul, and Sylvain de Lucia. 2024. <span>“Performance of Machine Translators in Translating French Medical Research Abstracts to English: A Comparative Study of DeepL, Google Translate, and CUBBITT.”</span> Edited by Iftikhar Ahmed Khan. <em>PLOS ONE</em> 19 (2): e0297183. <a href="https://doi.org/10.1371/journal.pone.0297183">https://doi.org/10.1371/journal.pone.0297183</a>.
</div>
<div id="ref-sen2021" class="csl-entry" role="listitem">
Sen, Indira, Fabian Flöck, Katrin Weller, Bernd Weiß, and Claudia Wagner. 2021. <span>“A Total Error Framework for Digital Traces of Human Behavior on Online Platforms.”</span> <em>Public Opinion Quarterly</em> 85 (S1): 399–422. <a href="https://doi.org/10.1093/poq/nfab018">https://doi.org/10.1093/poq/nfab018</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>